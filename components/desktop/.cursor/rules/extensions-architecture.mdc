---
globs: ["**/desktop/extensions/**/*"]
alwaysApply: false
---
## Расширения (Extensions)

### Общее устройство

Расширения - это изолированные модули приложения, каждый из которых реализует отдельный функционал. Расширения максимально независимы и следуют принципам Feature Sliced Design.

### Структура расширения

```
extension-name/
  entities/        # Сущности расширения
  features/        # Фичи расширения
  widgets/         # Виджеты расширения
  pages/           # Страницы расширения
  index.ts         # export * from './entities' etc.
  install.ts       # IWorkspaceConfig с маршрутами и меню
```

### Файл install.ts

#### Роль и назначение
Файл `install.ts` отвечает за интеграцию расширения в систему рабочих столов. Он:
- Определяет маршруты расширения
- Настраивает меню рабочего стола
- Управляет видимостью в левом дровере
- Задает роли доступа к разделам

#### Структура конфигурации
```typescript
import { markRaw } from 'vue';
import type { IWorkspaceConfig } from 'src/shared/lib/types/workspace';

export default async function (): Promise<IWorkspaceConfig> {
  return {
    workspace: 'extension-name',     // Уникальный идентификатор рабочего стола
    title: 'Название рабочего стола', // Отображаемое название
    defaultRoute: 'default-route',    // Маршрут по умолчанию
    routes: [
      {
        meta: {
          title: 'Название раздела',
          icon: 'fa-solid fa-icon',
          roles: ['chairman', 'member', 'user'], // Роли с доступом: chairman, member, user. Пустой массив [] - доступ у всех
        },
        path: '/:coopname/extension-name',
        name: 'extension-name',
        component: markRaw(MainComponent),
        children: [
          // Вложенные маршруты
        ],
      },
    ],
  };
}
```

#### Уровни видимости в меню

##### Первый уровень: Рабочий стол
- Расширение появляется в меню рабочих столов
- Задается в корневом маршруте с `path: '/:coopname/extension-name'`

##### Второй уровень: Левый дровер
- Кнопки разделов внутри рабочего стола
- Управляется свойством `hidden: true/false` в meta роута
- Если `hidden: true` - раздел не отображается в левом дровере

#### Пример с видимостью
```typescript
{
  path: 'projects/:project_hash/tasks/:issue_hash',
  name: 'project-issue',
  component: markRaw(IssuePage),
  meta: {
    title: 'Задача',
    icon: 'fa-solid fa-task',
    roles: [],
    agreements: agreementsBase,
    requiresAuth: true,
    hidden: true, // Не показывать в левом дровере
  },
}
```

### Экспорты расширения

#### index.ts расширения
```typescript
export * from './entities';
export * from './features';
export * from './widgets';
export * from './pages';
```

#### Регистрация в системе
Расширения регистрируются через систему расширений и становятся доступны в магазине расширений для установки.

### Правила изоляции

#### Запреты
- ❌ Импорты между расширениями запрещены
- ❌ Совместное использование сущностей между расширениями
- ❌ Прямые зависимости между расширениями

#### Разрешения
- ✅ Импорт из `src/shared` (общие компоненты)
- ✅ Исключения: `FailAlert`, `SuccessAlert` (глобальные уведомления)

### Важные принципы

#### Разделение ответственности
- **Entities**: Только данные и их загрузка
- **Features**: Бизнес-логика и действия
- **Widgets**: Комплексные UI компоненты
- **Pages**: Корневые страницы расширения

#### Конфигурация меню
- Роли доступа: `chairman`, `member`, `user`
- Пустой массив `roles: []` означает доступ у всех ролей
- Видимость управляется через `hidden` свойство
- Иконки и названия должны быть информативными

#### Разработка расширений
- Расширения разрабатываются независимо
- Каждый расширение - отдельный функциональный модуль
- Возможность отключения/включения расширений
