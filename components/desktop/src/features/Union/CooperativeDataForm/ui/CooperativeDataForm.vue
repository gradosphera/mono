<template lang="pug">
div
  Form(:handler-submit="saveData" :showCancel="true" :button-cancel-txt="'–ù–∞–∑–∞–¥'" :button-submit-txt="'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å'" @cancel="handleBack").q-gutter-md

    //- –î–æ–º–µ–Ω –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞
    .form-section.q-mb-lg
      .section-header.q-mb-md
        .section-title
          q-icon(name="domain" size="20px" color="primary").q-mr-sm
          span.text-subtitle1.text-weight-medium –î–æ–º–µ–Ω –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞
        .section-description.text-body2.q-mt-sm
          | –£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω –∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤

      q-input.form-input(
        standout="bg-teal text-white"
        hint="domovoy.com –∏–ª–∏ coop.domovoy.com"
        label="–î–æ–º–µ–Ω –∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞"
        v-model="formData.announce"
        :rules="[val => notEmpty(val), val => isDomain(val)]"
      )

    //- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    .form-section.q-mb-lg
      .section-header.q-mb-md
        .section-title
          q-icon(name="account_balance_wallet" size="20px" color="secondary").q-mr-sm
          span.text-subtitle1.text-weight-medium –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        .section-description.text-body2.q-mt-sm
          | –í–≤–µ–¥–∏—Ç–µ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–∞–µ–≤—ã–µ –≤–∑–Ω–æ—Å—ã –ø–∞–π—â–∏–∫–æ–≤. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –≤ —É—Å—Ç–∞–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞.

      .financial-grid
        .grid-section.q-mb-md
          .subsection-title.text-body1.text-weight-medium.q-mb-sm –î–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –∏ –ò–ü
          .input-row.q-mb-sm
            q-input.form-input(
              standout="bg-teal text-white"
              placeholder="100"
              label="–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å"
              v-model="formData.initial"
              type="number"
              :min="0"
              :rules="[val => notEmpty(val)]"
            )
              template(#append)
                span.text-overline RUB
          .input-row
            q-input.form-input(
              standout="bg-teal text-white"
              label="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–µ–≤—ã–π –≤–∑–Ω–æ—Å"
              placeholder="300"
              v-model="formData.minimum"
              type="number"
              :min="0"
              :rules="[val => notEmpty(val)]"
            )
              template(#append)
                span.text-overline RUB

        .grid-section
          .subsection-title.text-body1.text-weight-medium.q-mb-sm –î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
          .input-row.q-mb-sm
            q-input.form-input(
              standout="bg-teal text-white"
              placeholder="1000"
              label="–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å"
              v-model="formData.org_initial"
              type="number"
              :min="0"
              :rules="[val => notEmpty(val)]"
            )
              template(#append)
                span.text-overline RUB
          .input-row
            q-input.form-input(
              standout="bg-teal text-white"
              placeholder="3000"
              label="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–µ–≤—ã–π –≤–∑–Ω–æ—Å"
              v-model="formData.org_minimum"
              type="number"
              :min="0"
              :rules="[val => notEmpty(val)]"
            )
              template(#append)
                span.text-overline RUB
</template>
<script lang="ts" setup>
import { ref, watch } from 'vue'
import { Form } from 'src/shared/ui/Form';
import { notEmpty, isDomain } from 'src/shared/lib/utils';
import { useConnectionAgreementStore } from 'src/entities/ConnectionAgreement';
import type { ICooperativeFormData } from 'src/entities/ConnectionAgreement/model/types';


const emit = defineEmits(['continue', 'back'])

const connectionAgreement = useConnectionAgreementStore()

// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é
const formData = ref<ICooperativeFormData>({
  announce: connectionAgreement.formData.announce || '',
  initial: connectionAgreement.formData.initial || '',
  minimum: connectionAgreement.formData.minimum || '',
  org_initial: connectionAgreement.formData.org_initial || '',
  org_minimum: connectionAgreement.formData.org_minimum || ''
})

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ store
watch(() => connectionAgreement.formData, (newFormData) => {
  formData.value = {
    announce: newFormData.announce || '',
    initial: newFormData.initial || '',
    minimum: newFormData.minimum || '',
    org_initial: newFormData.org_initial || '',
    org_minimum: newFormData.org_minimum || ''
  }
}, { deep: true })

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å store –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
const syncFormData = () => {
  connectionAgreement.setFormData(formData.value)
}

const handleBack = () => {
  emit('back')
}

const saveData = async () => {
  console.log('üì§ CooperativeDataForm: –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã:', formData.value)
  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å store –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  syncFormData()
  emit('continue', formData.value)
}
</script>

<style scoped>
.form-section {
  padding: 1.5rem;
  border-radius: 16px;
  border: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.section-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding-bottom: 1rem;
  display: block;
}

.section-title {
  display: flex;
  align-items: center;
  margin-bottom: 0.25rem;
}

.section-description {
  line-height: 1.5;
}

.financial-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.grid-section {
  padding: 1rem;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.03);
}

.subsection-title {
  color: var(--q-primary);
  border-bottom: 2px solid var(--q-primary);
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
}

.input-row {
  margin-bottom: 1rem;
}

.input-row:last-child {
  margin-bottom: 0;
}

.form-input {
  margin-bottom: 0;
}

/* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏ */
.form-section + .form-section {
  margin-top: 2rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .financial-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .form-section {
    padding: 1.25rem;
  }
}

@media (max-width: 480px) {
  .form-section {
    padding: 1rem;
  }

  .section-title {
    flex-direction: column;
    gap: 0.5rem;
    text-align: center;
  }

  .section-header {
    text-align: center;
    display: block !important;
  }

  .section-description {
    display: block !important;
    width: 100% !important;
  }

  .financial-grid {
    gap: 1rem;
  }

  .grid-section {
    padding: 0.75rem;
  }

  .subsection-title {
    font-size: 1rem;
  }
}
</style>
