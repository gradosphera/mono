# Technical Specification: Виджет участников проекта

**Date:** 2026-02-04
**Author:** AI Assistant
**Version:** 1.0
**Project Type:** web-app
**Project Level:** 1
**Status:** Draft

---

## Document Overview

This Technical Specification provides focused technical planning for Виджет участников проекта. It is designed for smaller projects (Level 0-1) that need clear requirements without heavyweight PRD overhead.

**Related Documents:**
- Product Brief: docs/product-brief-виджет-участников-проекта-2026-02-04.md

---

## Problem & Solution

### Problem Statement

Пользователи не имеют полной информации о своем участии в проекте. Существует две критические проблемы:

1. **Отсутствие информации о вкладах**: После регистрации в проекте участник получает долю авторского права, но эта информация не отображается в интерфейсе. Виджет показывает только текущую информацию об участии, но не исторические данные о вкладах.

2. **Неправильная логика отображения участников**: Участники отображаются в виджете только после того, как сделали конкретный вклад в проект. Однако участники должны отображаться сразу после подачи заявления на участие и получения доступа к проекту. Это приводит к тому, что новые участники не видят себя в списке участников до тех пор, пока не внесут вклад.

### Proposed Solution

Комплексное улучшение виджета участников проекта:

1. **Исправление логики отображения участников**: Участники должны отображаться сразу после получения доступа к проекту (после подачи заявления и подписания соглашения об участии), а не только после внесения вклада.

2. **Добавление информации о вкладах**: Графическое отображение количества вкладов участника и информации о процессе становления участником проекта.

---

## Requirements

### What Needs to Be Built

- Исправление логики отображения участников (отображение сразу после получения доступа)
- Добавление поля с количеством вкладов в графической форме
- Интеграция с API для получения данных о вкладах и статусе участников
- Отображение ролей участников
- Тестирование новой функциональности

### What This Does NOT Include

- Изменение существующей логики учета вкладов
- Переработка дизайна всего виджета
- Добавление новых типов участников
- Интеграция с внешними системами учета

---

## Technical Approach

### Technology Stack

- **Frontend Framework:** Vue 3 + TypeScript + Vite
- **UI Library:** Quasar Framework
- **State Management:** Pinia
- **API:** GraphQL (Zeus SDK)
- **Backend:** NestJS + TypeORM + PostgreSQL
- **Blockchain Integration:** CoopTypes contracts

### Architecture Overview

Проект использует FSD архитектуру с разделением на:
- **Widgets Layer:** ContributorsListWidget - компонент отображения таблицы участников
- **Entities Layer:** Contributor entity с store для управления данными
- **Shared Layer:** Утилиты форматирования и API клиенты

Данные участников хранятся в композитной сущности: часть в PostgreSQL БД, часть синхронизируется из блокчейна. Логика создания участников должна быть изменена с "при первом вкладе" на "при подтверждении доступа к проекту".

### Data Model (if applicable)

**Contributor Entity:**
- id, username, coopname - базовые данные
- contributor_hash - уникальный идентификатор в блокчейне
- appendixes[] - массив хэшей проектов с доступом
- contributed_as_* - поля с количеством вкладов по ролям
- status - статус участника
- created_at - дата создания

**Segments Table:**
- Связь между участниками и их вкладами
- Используется для расчета contributed_as_* полей

### API Design (if applicable)

**GraphQL Queries:**
- `capitalContributors(filter, options)` - получение списка участников с пагинацией
- Фильтры: coopname, project_hash (опционально)
- Пагинация: page, limit, sortBy, descending

**Требуемые изменения:**
- Модификация логики создания Contributor - создавать при подтверждении appendix вместо первого вклада
- Добавление расчета количества вкладов для каждого участника
- Обновление ContributorSelector для включения поля общего количества вкладов

---

## Implementation Plan

### Stories

1. **Исправить логику создания участников** - Изменить процесс создания Contributor с "при первом вкладе" на "при подтверждении доступа к проекту"
2. **Добавить расчет количества вкладов** - Создать логику агрегации данных из segments для каждого участника
3. **Обновить GraphQL селектор** - Добавить поле общего количества вкладов в ContributorSelector
4. **Обновить UI компонент** - Добавить отображение количества вкладов в ContributorsListWidget
5. **Тестирование новой функциональности** - Провести интеграционное тестирование всех изменений

### Development Phases

**Phase 1: Backend Changes (3 дня)**
- Изменение логики создания участников
- Добавление расчета количества вкладов
- Обновление GraphQL селектора

**Phase 2: Frontend Updates (2 дня)**
- Обновление UI компонента
- Тестирование отображения

**Phase 3: Integration & Testing (2 дня)**
- Интеграционное тестирование
- Проверка существующих функций

---

## Acceptance Criteria

How we'll know it's done:

- Участники отображаются в виджете сразу после получения доступа к проекту (подписания соглашения об участии)
- Виджет корректно отображает количество вкладов участников
- Информация о вкладах представлена в понятной графической форме
- Роли участников корректно отображаются после назначения
- Новая функциональность не нарушает работу существующего виджета
- Все acceptance criteria из Product Brief выполнены

---

## Non-Functional Requirements

### Performance

- Время загрузки списка участников не должно превышать 2 секунды
- Расчет количества вкладов должен выполняться эффективно без дополнительных N+1 запросов
- Пагинация должна работать плавно при большом количестве участников

### Security

- Доступ к данным участников только для авторизованных пользователей кооператива
- Валидация всех входных данных на backend
- Логирование операций с данными участников

### Other

- Адаптивный дизайн для различных устройств
- Поддержка существующих браузеров (Chrome, Firefox, Safari)
- Локализация на русский язык

---

## Dependencies

- Доступ к существующей инфраструктуре PostgreSQL и блокчейна
- Существующие API для работы с appendix и segments
- Команда backend разработчиков для изменений в логике создания участников

---

## Risks & Mitigation

- **Технические сложности изменения логики создания участников**
  - **Likelihood:** Средний
  - **Mitigation:** Предварительный анализ кода и создание плана отката

- **Проблемы с производительностью при расчете вкладов**
  - **Likelihood:** Средний
  - **Mitigation:** Оптимизация запросов, использование индексов БД

- **Несовместимость с существующей синхронизацией блокчейна**
  - **Likelihood:** Низкий
  - **Mitigation:** Тщательное тестирование синхронизации данных

---

## Timeline

**Target Completion:** 2026-02-18 (2 недели после начала разработки)

**Milestones:**
- Завершение анализа требований: 2026-02-04 (1 день)
- Разработка backend изменений: 2026-02-05 - 2026-02-07 (3 дня)
- Frontend обновления: 2026-02-10 - 2026-02-11 (2 дня)
- Интеграционное тестирование: 2026-02-12 - 2026-02-13 (2 дня)
- Деплой и мониторинг: 2026-02-14 - 2026-02-18 (1 неделя)

---

## Approval

**Reviewed By:**
- [ ] AI Assistant (Author)
- [ ] Technical Lead
- [ ] Product Owner

---

## Next Steps

### Phase 4: Implementation

For Level 1 projects (1-10 stories):
- Run `/sprint-planning` to plan your sprint
- Then create and implement stories

---

**This document was created using BMAD Method v6 - Phase 2 (Planning)**

*To continue: Run `/workflow-status` to see your progress and next recommended workflow.*