# Изменения для реализации метода Водянова

## Обзор изменений

Согласно техническому заданию, изменен подход к учёту и распределению авторского вознаграждения:

1. **Авторы**: теперь устанавливаются с равными долями
2. **Распределение премий**: 68.2% идет напрямую получателям, 31.8% распределяется по методу Водянова
3. **Участники голосования**: авторы и создатели проекта

## Новые структуры данных

### vodyanov_distribution
Хранит общую информацию о голосовании для конкретного результата:
- `result_hash` - хэш результата
- `participants` - список участников голосования
- `total_amount` - общая сумма к распределению (31.8% от премий)
- `voting_amount` - голосующая сумма
- `equal_share` - равная доля

### vodyanov_vote
Хранит индивидуальные голоса участников:
- `voter` - кто голосует
- `recipient` - кому голосует
- `amount` - сумма голоса

### vodyanov_result
Хранит финальные результаты распределения:
- `participant` - участник
- `votes_received` - сумма полученных голосов
- `final_amount` - итоговая сумма (голоса + равная доля)

## Новые действия

### startvodyanov
Начинает голосование по методу Водянова:
- Автоматически запускается после авторизации результата советом
- Требует минимум 2 участника
- Рассчитывает суммы для распределения

### submitvote
Подача голоса участником:
- Участник распределяет `voting_amount` между остальными участниками
- Нельзя голосовать за себя
- Общая сумма голосов должна равняться `voting_amount`

### finalvodyanov
Завершение голосования и расчет результатов:
- Запускается когда все проголосовали или истек срок
- Рассчитывает итоговые суммы по формуле Водянова
- Обновляет балансы участников

## Изменения в существующих функциях

### calculcate_generation_amounts
Добавлены новые поля в структуру `generation_result`:
- `authors_direct_bonus` - 68.2% от авторских премий
- `authors_vodyanov_bonus` - 31.8% от авторских премий  
- `creators_direct_bonus` - 68.2% от создательских премий
- `creators_vodyanov_bonus` - 31.8% от создательских премий
- `total_vodyanov_amount` - общая сумма для голосования

### addauthor
Изменена логика добавления авторов:
- Все авторы теперь имеют равные доли
- Параметр `shares` игнорируется

### authrslt
Добавлен автоматический запуск голосования:
- После авторизации результата советом
- Если есть минимум 2 участника

## Формула метода Водянова

```
голосующая_сумма = (Общая_сумма_распределения) * ((всего_голосующих - 1) / всего_голосующих)

Результат_участника = Среднее_арифметическое_голосов_от_других + (Общая_сумма / всего_участников)
```

## Процесс использования

1. Создается результат и подается на утверждение
2. Совет авторизует результат → автоматически запускается голосование
3. Каждый участник голосует, распределяя сумму между остальными
4. После голосования всех или истечения срока рассчитываются результаты
5. Участники получают 68.2% премий напрямую + сумму от голосования Водянова

## Файлы изменений

### Новые файлы:
- `src/vodyanov/startvodyanov.cpp`
- `src/vodyanov/submitvote.cpp` 
- `src/vodyanov/finalvodyanov.cpp`

### Измененные файлы:
- `include/tables.hpp` - новые структуры данных
- `capital.hpp` - новые действия и методы
- `capital.cpp` - изменена формула расчета премий
- `src/result/authrslt.cpp` - автозапуск голосования
- `src/managment/addauthor.cpp` - равные доли авторов 