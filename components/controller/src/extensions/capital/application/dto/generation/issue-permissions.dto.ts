import { ObjectType, Field } from '@nestjs/graphql';
import { IssueStatus } from '../../../domain/enums/issue-status.enum';

/**
 * DTO для прав доступа к задаче
 * Содержит набор флагов, определяющих возможности текущего пользователя
 * относительно конкретной задачи
 */
@ObjectType('CapitalIssuePermissions', {
  description: 'Права доступа пользователя к задаче',
})
export class IssuePermissionsOutputDTO {
  /**
   * Может ли пользователь редактировать задачу (название, описание, приоритет и т.д.)
   * true если пользователь является мастером проекта/компонента или ответственныйм задачи
   */
  @Field(() => Boolean, {
    description: 'Может ли редактировать задачу (название, описание, приоритет и т.д.)',
  })
  can_edit_issue!: boolean;

  /**
   * Может ли пользователь изменять статусы задачи
   * true если пользователь является мастером проекта/компонента, ответственныйм задачи,
   * создателем задачи или участником проекта (с ограничениями по статусам)
   */
  @Field(() => Boolean, {
    description: 'Может ли изменять статусы задачи',
  })
  can_change_status!: boolean;

  /**
   * Может ли пользователь назначать исполнителей задачи
   * true только если пользователь является мастером проекта или связанного с ним компонента
   */
  @Field(() => Boolean, {
    description: 'Может ли назначать исполнителей задачи',
  })
  can_assign_creator!: boolean;

  /**
   * Может ли пользователь устанавливать статус DONE
   * true только если пользователь является мастером проекта или связанного с ним компонента
   */
  @Field(() => Boolean, {
    description: 'Может ли устанавливать статус DONE (выполнена)',
  })
  can_set_done!: boolean;

  /**
   * Может ли пользователь устанавливать статус ON_REVIEW
   * true только если пользователь является ответственныйм задачи
   */
  @Field(() => Boolean, {
    description: 'Может ли устанавливать статус ON_REVIEW (на проверке)',
  })
  can_set_on_review!: boolean;

  /**
   * Может ли пользователь устанавливать оценку (estimate) задачи
   */
  @Field(() => Boolean, {
    description: 'Может ли устанавливать оценку (estimate) задачи',
  })
  can_set_estimate!: boolean;

  /**
   * Может ли пользователь устанавливать приоритет задачи
   */
  @Field(() => Boolean, {
    description: 'Может ли устанавливать приоритет задачи',
  })
  can_set_priority!: boolean;

  /**
   * Список допустимых статусов для перехода из текущего статуса
   * Массив статусов, в которые может перейти задача для текущего пользователя
   */
  @Field(() => [IssueStatus], {
    description: 'Список допустимых статусов для перехода',
  })
  allowed_status_transitions!: IssueStatus[];

  /**
   * Может ли пользователь удалить задачу
   * true только если пользователь имеет роль 'chairman'
   */
  @Field(() => Boolean, {
    description: 'Может ли удалить задачу',
  })
  can_delete_issue!: boolean;

  /**
   * Может ли пользователь создавать требования к задаче
   * true только если пользователь является мастером проекта
   */
  @Field(() => Boolean, {
    description: 'Может ли создавать требования к задаче',
  })
  can_create_requirement!: boolean;

  /**
   * Может ли пользователь удалять требования к задаче
   * true только если пользователь является мастером проекта
   */
  @Field(() => Boolean, {
    description: 'Может ли удалять требования к задаче',
  })
  can_delete_requirement!: boolean;

  /**
   * Может ли пользователь выполнять требования к задаче
   * true только если пользователь является мастером проекта
   */
  @Field(() => Boolean, {
    description: 'Может ли выполнять требования к задаче',
  })
  can_complete_requirement!: boolean;

  /**
   * Имеет ли пользователь подтвержденное приложение (clearance) для проекта
   * true если у пользователя есть подтвержденное приложение для данного проекта
   */
  @Field(() => Boolean, {
    description: 'Имеет ли подтвержденное приложение для проекта',
  })
  has_clearance!: boolean;

  /**
   * Является ли пользователь гостем (неавторизованным)
   * true только если пользователь не авторизован, false для всех авторизованных пользователей
   */
  @Field(() => Boolean, {
    description: 'Является ли пользователь гостем (неавторизованным)',
  })
  is_guest!: boolean;
}
