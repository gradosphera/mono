# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å—Ç–∏–ª—å

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **—á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** (Clean Architecture):

- –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ **–∏–Ω—Ç–µ—Ä–∞–∫—Ç–æ—Ä–∞—Ö**, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–æ–º–µ–Ω–Ω–æ–º —Å–ª–æ–µ.
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–æ—Ä—ã –≤—ã–∑—ã–≤–∞—é—Ç **–ø–æ—Ä—Ç—ã (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, —Å–µ—Ä–≤–∏—Å–æ–≤)**, –Ω–µ –∑–Ω–∞—è –æ–± –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º —Å–ª–æ–µ (–∞–¥–∞–ø—Ç–µ—Ä—ã –∫ –ë–î, –±–ª–æ–∫—á–µ–π–Ω—É –∏ —Ç.–ø.).
- Application —Å–ª–æ–π (—Ä–µ–∑–æ–ª–≤–µ—Ä—ã –∏ —Å–µ—Ä–≤–∏—Å—ã) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–∞, –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –∏–Ω—Ç–µ—Ä–∞–∫—Ç–æ—Ä—É.

- –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–ª–∞–±—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫—É—é —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

# –û–±—â–∏–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–±–æ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ, –æ—Ç—Ä–∞–∂–∞—é—â–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞:

- preProcessing ‚Äî –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –±–∞–∑–µ;
- processing ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –±–ª–æ–∫—á–µ–π–Ω, –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ;
- processed ‚Äî –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ.

–î–ª—è —Å–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ DTO –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∂—É—Ä–Ω–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (known_hash_events) ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö hash, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–æ–π. –•—ç—à –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∫–∞–∫ –Ω–∞ —ç—Ç–∞–ø–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ (source: db), —Ç–∞–∫ –∏ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–ª–æ–∫—á–µ–π–Ω–∞ (source: chain). –ö–∞–∂–¥—ã–π —Ñ–∞–∫—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å.

–ù–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏:

- –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ hash –∏–∑ –∂—É—Ä–Ω–∞–ª–∞.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ hash –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–±–∞–∑–∞, –±–ª–æ–∫—á–µ–π–Ω, –∏—Å—Ç–æ—Ä–∏—è).
- –§–æ—Ä–º–∏—Ä—É–µ–º DTO, –≤–∫–ª—é—á–∞—é—â–µ–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ç–∞–¥–∏–π.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –Ω–∞–¥—ë–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –¥–∞–∂–µ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω–æ–π –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö;
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞;
- –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –µ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

# –ñ—É—Ä–Ω–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (known_hash_events)

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ–π —Å–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –±–ª–æ–∫—á–µ–π–Ω), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∂—É—Ä–Ω–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è ‚Äî —Ç–∞–±–ª–∏—Ü–∞ known_hash_events, –∫–æ—Ç–æ—Ä–∞—è —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ —Å–ª—É—á–∞–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (hash) –≤ —Å–∏—Å—Ç–µ–º–µ.

–í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π, —ç—Ç–æ—Ç –∂—É—Ä–Ω–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è: –æ—Ç–∫—É–¥–∞ –ø–æ—Å—Ç—É–ø–∏–ª hash, –∏ –∫–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ. –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ hash –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø–æ–ª—É—á–µ–Ω –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–ª–∏ –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è

````ts
interface KnownHashEvent {
  id: string;
  hash: string;
  source: 'db' | 'chain';
  createdAt: string;
}

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ —Å source: 'db'.

–ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–ª–æ–∫—á–µ–π–Ω–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ —Å source: 'chain'.

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ hash, —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∂—É—Ä–Ω–∞–ª—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö hash –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ.

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
hash –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ‚Äî –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–ø–∏—Å–∏.

–ñ—É—Ä–Ω–∞–ª —è–≤–ª—è–µ—Ç—Å—è append-only ‚Äî —Å–æ–±—ã—Ç–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—ã–±–æ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö hash:

```ts
db.known_hash_events.distinct('hash')
````

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å hash –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Å–±–æ—Ä–∫—É –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —á–∞—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

–î–∞—ë—Ç –ø–æ–ª–Ω—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É: –æ—Ç–∫—É–¥–∞ –∏ –∫–æ–≥–¥–∞ –±—ã–ª –ø–æ–ª—É—á–µ–Ω –∫–∞–∂–¥—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.

–£–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É, –∞—É–¥–∏—Ç –∏ –ø–æ—Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ñ—É—Ä–Ω–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–ª—É–∂–∏—Ç –Ω–∞–¥—ë–∂–Ω–æ–π –æ—Å–Ω–æ–≤–æ–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –±–ª–æ–∫—á–µ–π–Ω–æ–º, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—É—é —Å–±–æ—Ä–∫—É –æ–±—ä–µ–∫—Ç–æ–≤.

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

## preProcessing ‚Üí processing ‚Üí processed

### üìå –¶–µ–ª—å

–û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–¥—ë–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ, –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ COOPOS, –∞ –∑–∞—Ç–µ–º —É–¥–∞–ª—è—é—Ç—Å—è, —Å–æ—Ö—Ä–∞–Ω—è—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π.

### üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç—Ä–∏ —á—ë—Ç–∫–∏–µ —Å—Ç–∞–¥–∏–∏:

#### preProcessing

–î–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ë–î.

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ –±–ª–æ–∫—á–µ–π–Ω.

–í –±–ª–æ–∫—á–µ–π–Ω–µ –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç.

#### processing

–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ COOPOS —á–µ—Ä–µ–∑ action, —Å–æ–∑–¥–∞–Ω—ã –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ.

–ë—ç–∫–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç trxId, blockNum, scope –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ª–µ–ø–æ–∫ —Ç–∞–±–ª–∏—Ü—ã.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–∂–µ–Ω–∏—è –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º.

#### processed

–¢–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã COOPOS (—á–µ—Ä–µ–∑ erase).

–°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ action trace (–∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π) –∏/–∏–ª–∏ deltas (–∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü)

–î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å –¥–∞–∂–µ –±–µ–∑ –ë–î.

# üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏

## –û–±—â–∞—è –∏–¥–µ—è

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–∞:

- AppRegistry ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞);

- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è—Ö –∏ –∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

üì¶ AppRegistry (~/extensions/extensions.registry.ts)
–≠—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ.
–ö–∞–∂–¥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–¥–µ—Å—å –æ–ø–∏—Å–∞–Ω–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IRegistryExtension.
–≠—Ç–æ –∫–∞–∫ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –∏–ª–∏ –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π: –æ–Ω–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –Ω–æ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã.

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:

- schema ‚Äî Zod-—Å—Ö–µ–º–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏;
- title, description, image, tags ‚Äî –º–µ—Ç–∞-–æ–ø–∏—Å–∞–Ω–∏–µ;
- available ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–µ;
- readme, instructions ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—á–∞—Å—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º–∞—è).

## üóÉ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–∏–∑ –ë–î)

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

–ö–∞–∂–¥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏:

- config ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è;
- enabled ‚Äî –≤–∫–ª—é—á–µ–Ω–æ –∏–ª–∏ –Ω–µ—Ç;
- created_at, updated_at ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏;
- name ‚Äî –∫–ª—é—á, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å AppRegistry.

## –õ–æ–≥–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–¥–Ω–æ–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ GraphQL API), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å AppManagementService, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

### üîß –ü—Ä–æ—Ü–µ—Å—Å:

#### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ AppRegistry:

–ß–µ—Ä–µ–∑ extractAppRegistryData() –±–µ—Ä—É—Ç—Å—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

–ö–∞–∂–¥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è: schema (–∏–∑ Zod ‚Üí JSON), readme, instructions.

#### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∞–∑—ã:

–ú–µ—Ç–æ–¥ getAppList() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

#### –°–±–æ—Ä–∫–∞ DTO:

–ú–µ—Ç–æ–¥ buildAppData() –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ –∏ –±–∞–∑—ã:

–î–∞–Ω–Ω—ã–µ –∏–∑ AppRegistry: –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ö–µ–º–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Ç.–¥.

–î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã: –≤–∫–ª—é—á–µ–Ω–æ –ª–∏, –∫–æ–Ω—Ñ–∏–≥, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ExtensionDTO ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

#### üì¶ ExtensionDTO

–≠—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —É—Ö–æ–¥–∏—Ç –Ω–∞—Ä—É–∂—É (–≤ GraphQL).
–û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

–º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –∏–∑ AppRegistry ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–≥–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏;

—Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î ‚Äî —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏, –≤–∫–ª—é—á–µ–Ω–æ –ª–∏, –∫–∞–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## –ü—Ä–∏–Ω—Ü–∏–ø

AppRegistry ‚Äî —ç—Ç–æ –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏–µ.

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

AppManagementService ‚Äî —ç—Ç–æ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–±–∞ —Å–ª–æ—è –≤ –µ–¥–∏–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.

# üîê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## –û–±—â–∏–π –ø–æ–¥—Ö–æ–¥

–°–∏—Å—Ç–µ–º–∞ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∏ –Ω–µ–ø–æ–¥–¥–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º SHA-256, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–π –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π, —Ç–∞–∫ –∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ.

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ö—ç—à–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### üìÑ –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞ (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å)

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞**:

   - –°–æ–∑–¥–∞—ë—Ç—Å—è PDF –¥–æ–∫—É–º–µ–Ω—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
   - –î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ Uint8Array (–±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

2. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞**:

   ```typescript
   const binary: Uint8Array = await PDFService.updateMetadata(buffer, meta);
   const hash = calculateSha256(binary);
   ```

   –§—É–Ω–∫—Ü–∏—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

   ```typescript
   export function calculateSha256(buffer: Uint8Array): string {
     const hash = createHash('sha256');
     hash.update(buffer);
     return hash.digest('hex').toUpperCase();
   }
   ```

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**:
   - –î–æ–∫—É–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MongoDB –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PDF —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ MongoDB Binary –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ `Binary.createFromBase64(base64String, 0)`
   - –•—ç—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

### üîÑ –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

1. **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:

   - –ü—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, MongoDB Binary –æ–±—ä–µ–∫—Ç –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ base64 —Å—Ç—Ä–æ–∫—É:

   ```typescript
   this.binary = Buffer.from(data.binary.buffer).toString('base64');
   ```

2. **–ü–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ GraphQL API**:
   - –î–æ–∫—É–º–µ–Ω—Ç –≤–∫–ª—é—á–∞—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Ö—ç—à –∏ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64 –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
   - –§–æ—Ä–º–∞—Ç base64 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ JSON

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å)

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:

   ```typescript
   // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ base64
   const binaryString = atob(doc.value.binary);
   const len = binaryString.length;
   const data = new Uint8Array(len);

   for (let i = 0; i < len; i++) {
     data[i] = binaryString.charCodeAt(i);
   }
   ```

2. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏**:

   ```typescript
   regeneratedHash.value = (await useGlobalStore().hashMessage(data)).toUpperCase();
   ```

   –§—É–Ω–∫—Ü–∏—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

   ```typescript
   export const hashSHA256 = async (message: string | Uint8Array): Promise<string> => {
     const msgBuffer = message instanceof Uint8Array ? message : new TextEncoder().encode(message);
     const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
     const hashArray = Array.from(new Uint8Array(hashBuffer));
     const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');
     return hashHex;
   };
   ```

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö—ç—à–µ–π**:
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ö—ç—à —Å —Ö—ç—à–µ–º, –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –ï—Å–ª–∏ —Ö—ç—à–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Node.js –º–æ–¥—É–ª—å crypto –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è SHA-256
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Web Crypto API (crypto.subtle.digest)
- –î–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Ö—ç—à –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä (toUpperCase)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ base64 –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é atob() –≤ –±—Ä–∞—É–∑–µ—Ä–µ
